<div class="container py-4">
  <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
    <div>
      <div class="text-muted small">Listing #<%= @listing.id %></div>
      <h1 class="h3 mb-0"><%= @listing.title %></h1>
    </div>
    <div class="d-flex gap-2">
      <%= link_to "Edit", edit_admin_listing_path(@listing), class: "btn btn-primary" %>
      <%= link_to "View public", listing_path(@listing), class: "btn btn-outline-secondary", target: "_blank" %>
    </div>
  </div>

  <div class="row g-3">
    <div class="col-12 col-lg-7">
      <div class="card shadow-sm">
        <div class="card-body">
          <div class="d-flex justify-content-between flex-wrap gap-2 mb-2">
            <div>
              <div class="text-muted small">Seller</div>
              <div class="fw-semibold"><%= @listing.user&.name || "-" %></div>
              <div class="text-muted small"><%= @listing.user&.email || "-" %></div>
            </div>

            <div class="text-end">
              <% if @listing.published_at.present? %>
                <span class="badge bg-success">published</span>
              <% else %>
                <span class="badge bg-warning text-dark">draft</span>
              <% end %>
              <div class="text-muted small mt-1">
                Created: <%= @listing.created_at.strftime("%d/%m/%Y %H:%M") %>
              </div>
            </div>
          </div>

          <hr>

          <div class="row g-2">
            <div class="col-6">
              <div class="text-muted small">Category</div>
              <div class="fw-semibold"><%= @listing.category&.name.presence || "-" %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Condition</div>
              <div class="fw-semibold"><%= @listing.condition.presence || "-" %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Start price</div>
              <div class="fw-semibold"><%= @listing.start_price || "-" %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Buy now</div>
              <div class="fw-semibold">
                <%= @listing.buy_now_enabled? ? (@listing.buy_now_price || "-") : "off" %>
              </div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Auction ends</div>
              <div class="fw-semibold"><%= @listing.auction_ends_at || "-" %></div>
            </div>
            <div class="col-6">
              <div class="text-muted small">Published at</div>
              <div class="fw-semibold"><%= @listing.published_at || "-" %></div>
            </div>
          </div>

          <hr>

          <div class="text-muted small mb-1">Seller note</div>
          <div class="border rounded p-3 bg-light"><%= simple_format(@listing.seller_note.to_s) %></div>
        </div>
      </div>

      <div class="card shadow-sm mt-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-center">
            <h2 class="h6 mb-0">Recent bids</h2>
            <div class="text-muted small"><%= @listing.bids.count %> bids</div>
          </div>
          <hr class="my-2">

          <div class="table-responsive">
            <table class="table table-sm align-middle mb-0">
              <thead class="text-muted small">
                <tr>
                  <th>Bidder</th>
                  <th class="text-end">Amount</th>
                  <th class="text-nowrap">Time</th>
                </tr>
              </thead>
              <tbody>
                <% @listing.bids.order(created_at: :desc).limit(20).each do |b| %>
                  <tr>
                    <td>
                      <div class="fw-semibold"><%= b.user&.name || "-" %></div>
                      <div class="text-muted small"><%= b.user&.email || "-" %></div>
                    </td>
                    <td class="text-end fw-semibold"><%= b.amount %></td>
                    <td class="text-nowrap text-muted"><%= b.created_at.strftime("%d/%m %H:%M") %></td>
                  </tr>
                <% end %>

                <% if @listing.bids.blank? %>
                  <tr><td colspan="3" class="text-center text-muted py-3">Chưa có bid.</td></tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <div class="col-12 col-lg-5">
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h6">Images</h2>
          <div class="row g-2">
            <% @listing.images.each do |img| %>
              <div class="col-6">
                <%= image_tag img, class: "w-100 rounded", style: "aspect-ratio:1/1;object-fit:cover;" %>
              </div>
            <% end %>
            <% if @listing.images.blank? %>
              <div class="text-muted">Không có ảnh.</div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
