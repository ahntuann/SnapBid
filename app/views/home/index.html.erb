<div class="container" style="max-width: 1100px;">
  <div class="d-flex flex-wrap align-items-center justify-content-between gap-2 mb-3">
    <div class="fw-semibold fs-4">Các sản phẩm đấu giá</div>

    <form method="get" action="<%= root_path %>" class="d-flex gap-2 flex-wrap flex-grow-1 justify-content-end">
      <input type="text"
             name="q"
             value="<%= @q %>"
             placeholder="<%= t("home.search_placeholder") %>"
             class="form-control"
             style="max-width: 420px;" />

      <select name="sort" class="form-select" style="max-width: 180px;">
        <option value="newest" <%= "selected" if @sort=="newest" %>><%= t("home.filters.newest") %></option>
        <option value="price_asc" <%= "selected" if @sort=="price_asc" %>><%= t("home.filters.price_asc") %></option>
        <option value="price_desc" <%= "selected" if @sort=="price_desc" %>><%= t("home.filters.price_desc") %></option>
      </select>

      <button type="submit" class="btn btn-primary">Tìm</button>
    </form>
  </div>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <form method="get" action="<%= root_path %>" class="row g-2 align-items-end">
        <input type="hidden" name="q" value="<%= @q %>">
        <input type="hidden" name="sort" value="<%= @sort %>">

        <div class="col-12 col-md-4">
          <label class="form-label small text-muted mb-1"><%= t("home.filters.category") %></label>
          <select name="category" class="form-select">
            <option value=""><%= t("home.filters.all") %> - <%= t("home.filters.category") %></option>
            <% @categories.each do |c| %>
              <option value="<%= c %>" <%= "selected" if @category==c %>><%= c %></option>
            <% end %>
          </select>
        </div>

        <div class="col-12 col-md-4">
          <label class="form-label small text-muted mb-1"><%= t("home.filters.condition") %></label>
          <select name="condition" class="form-select">
            <option value=""><%= t("home.filters.all") %> - <%= t("home.filters.condition") %></option>
            <% @conditions.each do |c| %>
              <option value="<%= c %>" <%= "selected" if @condition==c %>><%= c %></option>
            <% end %>
          </select>
        </div>

        <div class="col-12 col-md-4 d-flex gap-2">
          <button type="submit" class="btn btn-outline-secondary flex-grow-1">Lọc</button>
          <a href="<%= root_path %>" class="btn btn-light border flex-grow-1">Làm mới</a>
        </div>
      </form>
    </div>
  </div>

  <!-- GRID: mobile 1 card/row, tablet 2, desktop 4 -->
  <div class="row g-3">
    <% @listings.each do |listing| %>
      <div class="col-12 col-sm-6 col-lg-3">
        <%= link_to listing_path(listing), class: "text-decoration-none text-dark" do %>
          <div class="card shadow-sm h-100 border-0 position-relative"> <div class="position-absolute top-0 end-0 p-2" style="z-index: 10;">
              <% if listing.ai_verified? %>
                <span class="badge bg-success bg-opacity-75 backdrop-blur shadow-sm">
                  <i class="bi bi-patch-check-fill"></i> Đã xác thực
                </span>
              <% else %>
                <span class="badge bg-secondary bg-opacity-75 backdrop-blur shadow-sm">
                  Chưa xác thực
                </span>
              <% end %>
            </div>
            <div class="card-body p-0"> <% if listing.images.attached? %>
                <%= image_tag listing.images.first.variant(resize_to_fill: [900, 900]),
                      class: "sb-cover card-img-top", # Thêm card-img-top
                      loading: "lazy" %>
              <% else %>
                <div class="sb-cover d-flex align-items-center justify-content-center text-muted bg-light card-img-top">
                  <i class="bi bi-image fs-3"></i>
                </div>
              <% end %>

              <div class="p-3"> <div class="mt-0 fw-semibold text-truncate"><%= listing.title %></div>

                <div class="text-primary fw-semibold small mt-1">
                  <%= t("ui.listing.start_price") %>:
                  <%= listing.start_price.present? ? number_to_currency(listing.start_price, unit: "₫", precision: 0) : "—" %>
                </div>

                <div class="text-muted small mt-1">
                  <%= listing.category.presence || "—" %> • <%= listing.condition.presence || "—" %>
                </div>
              </div>
            </div>
          </div>
        <% end %>
      </div>
    <% end %>
  </div>

  <div class="d-flex justify-content-center mt-4">
    <%= paginate @listings %>
  </div>
</div>
