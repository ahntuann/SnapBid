<%# ============================================================
    SnapBid Navbar — Apple-style
    CSS: app/assets/stylesheets/navbar.css + application.css (section 7–8)
    JS:  app/javascript/navbar.js
    ============================================================ %>

<nav class="navbar navbar-expand-lg fixed-top apple-navbar" data-apple-mega="true">
  <div class="container">

    <%# ===== BRAND / LOGO ===== %>
    <%= link_to root_path, class: "navbar-brand fw-bold d-flex align-items-center gap-2", aria: { label: "SnapBid trang chủ" } do %>
      <i class="bi bi-gem" style="font-size:1.1rem;"></i>
      SnapBid
    <% end %>

    <%# ===== BURGER (mobile) ===== %>
    <button class="navbar-toggler" type="button"
            data-bs-toggle="collapse" data-bs-target="#mainNav"
            aria-controls="mainNav" aria-expanded="false" aria-label="Mở menu">
      <span class="navbar-toggler-icon"></span>
    </button>

    <%# ===== COLLAPSE WRAPPER ===== %>
    <div class="collapse navbar-collapse" id="mainNav">

      <%# ===== MENU CHÍNH (căn giữa) ===== %>
      <ul class="navbar-nav mx-lg-auto align-items-lg-center apple-navbar__menu">
        <% if user_signed_in? %>
          <li class="nav-item">
            <%= link_to "Cửa Hàng", root_path,
                class: "nav-link js-mega-trigger",
                data: { mega: "explore" },
                role: "button",
                aria: { controls: "mega-explore", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>

          <li class="nav-item">
            <%= link_to "Đăng Bán", seller_listings_path,
                class: "nav-link js-mega-trigger",
                data: { mega: "sell" },
                role: "button",
                aria: { controls: "mega-sell", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>

          <li class="nav-item">
            <%= link_to "Đấu Giá Của Tôi", my_bids_path,
                class: "nav-link js-mega-trigger",
                data: { mega: "mine" },
                role: "button",
                aria: { controls: "mega-mine", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>

          <li class="nav-item">
            <%= link_to "Hỗ Trợ", help_path,
                class: "nav-link js-mega-trigger",
                data: { mega: "support" },
                role: "button",
                aria: { controls: "mega-support", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>
        <% else %>
          <li class="nav-item">
            <%= link_to "Cửa Hàng", root_path,
                class: "nav-link js-mega-trigger",
                data: { mega: "explore" },
                role: "button",
                aria: { controls: "mega-explore", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>

          <li class="nav-item">
            <%= link_to "Giới Thiệu", "#",
                class: "nav-link js-mega-trigger",
                data: { mega: "about" },
                role: "button",
                aria: { controls: "mega-about", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>

          <li class="nav-item">
            <%= link_to "Hỗ Trợ", help_path,
                class: "nav-link js-mega-trigger",
                data: { mega: "support" },
                role: "button",
                aria: { controls: "mega-support", expanded: "false" },
                "aria-haspopup": "true" %>
          </li>
        <% end %>
      </ul>

      <%# ===== ACTIONS (bên phải) ===== %>
      <div class="apple-navbar__actions d-flex align-items-lg-center gap-2 ms-lg-auto">

        <%# -- Search icon (desktop: icon expand; mobile: vào trong collapse) -- %>
        <button class="sb-nav-search-btn d-none d-lg-inline-flex"
                id="sb-search-btn"
                type="button"
                aria-label="Tìm kiếm"
                aria-expanded="false"
                aria-controls="sb-search-overlay">
          <i class="bi bi-search sb-search-open"></i>
          <i class="bi bi-x-lg sb-search-close"></i>
        </button>

        <% if user_signed_in? %>
          <%# -- Notification bell -- %>
          <div class="nav-item position-relative">
            <%= render "shared/notifications_bell" %>
          </div>

          <%# -- Avatar dropdown -- %>
          <div class="nav-item position-relative" data-controller="dropdown">
            <a class="nav-link sb-nav-profile-link d-flex align-items-center gap-2 p-0"
               href="#"
               role="button"
               data-action="click->dropdown#toggle"
               aria-label="Tài khoản của <%= current_user.name.presence || current_user.email %>">
              <span class="sb-nav-avatar">
                <% if current_user.avatar.attached? %>
                  <%= image_tag current_user.avatar.variant(resize_to_fill: [32, 32]),
                        alt: "Avatar" %>
                <% else %>
                  <i class="bi bi-person"></i>
                <% end %>
              </span>
            </a>

            <ul class="dropdown-menu dropdown-menu-end" data-dropdown-target="menu" style="margin-top:8px;">
              <li><%= link_to "Đơn hàng",  orders_path,  class: "dropdown-item" %></li>
              <li><%= link_to "Tài khoản", profile_path, class: "dropdown-item" %></li>
              <% if current_user.admin? %>
                <li><%= link_to "Admin", admin_root_path, class: "dropdown-item" %></li>
              <% end %>
              <li><hr class="dropdown-divider"></li>
              <li>
                <%= button_to "Đăng xuất",
                      destroy_user_session_path,
                      method:  :delete,
                      form:    { class: "m-0" },
                      class:   "dropdown-item text-danger",
                      data:    { turbo_confirm: "Bạn chắc chắn muốn đăng xuất?" } %>
              </li>
            </ul>
          </div>

        <% else %>
          <%= link_to "Đăng nhập", new_user_session_path,    class: "btn btn-outline-primary btn-sm apple-navbar__btn" %>
          <%= link_to "Đăng ký",   new_user_registration_path, class: "btn btn-primary     btn-sm apple-navbar__btn" %>
        <% end %>

        <%# -- Mobile search (trong collapse) -- %>
        <div class="d-lg-none w-100 mt-2">
          <%= form_with url: root_path, method: :get, local: true do |f| %>
            <div class="sb-search-form-wrap">
              <i class="bi bi-search sb-nav-search-input-icon"></i>
              <%= f.text_field :q,
                    value: params[:q],
                    class: "sb-nav-search-input",
                    placeholder: "Tìm kiếm sản phẩm...",
                    aria: { label: "Tìm kiếm" },
                    autocomplete: "off",
                    id: "sb-search-mobile-input" %>
            </div>
          <% end %>
        </div>

      </div><%# /actions %>
    </div><%# /collapse %>
  </div><%# /container %>

  <%# ===== MEGA MENU OVERLAY (desktop) ===== %>
  <div class="apple-mega-overlay" hidden></div>

  <%# ===== MEGA PANELS ===== %>
  <div class="apple-mega-panels" aria-label="Mega menu">

    <%# -- EXPLORE / CỬA HÀNG -- %>
    <section id="mega-explore" class="apple-mega-panel" data-mega-panel="explore" hidden>
      <div class="container apple-mega-panel__inner">
        <div class="apple-mega-col">
          <div class="apple-mega-title">Khám phá</div>
          <a class="apple-mega-link" href="<%= root_path(sort: "ending_soon") %>">Sắp kết thúc</a>
          <a class="apple-mega-link" href="<%= root_path(sort: "newest") %>">Mới đăng</a>
          <a class="apple-mega-link" href="<%= root_path %>">Tất cả sản phẩm</a>
          <a class="apple-mega-link" href="#">Danh mục phổ biến</a>
        </div>

        <div class="apple-mega-col">
          <div class="apple-mega-title">Bộ lọc nhanh</div>
          <a class="apple-mega-link" href="#">Điện tử</a>
          <a class="apple-mega-link" href="#">Thời trang</a>
          <a class="apple-mega-link" href="#">Đồ sưu tầm</a>
          <a class="apple-mega-link" href="#">Gia dụng</a>
          <a class="apple-mega-link" href="#">Đồ công nghệ</a>
        </div>

        <div class="apple-mega-col apple-mega-col--cards">
          <div class="apple-mega-title">Gợi ý hôm nay</div>
          <a class="apple-mega-card" href="<%= root_path(sort: "ending_soon") %>">
            <div class="apple-mega-card__icon"><i class="bi bi-alarm"></i></div>
            <div>
              <div class="apple-mega-card__headline">Canh phiên sắp chốt</div>
              <div class="apple-mega-card__sub">Ưu tiên món còn dưới 30 phút.</div>
            </div>
          </a>
          <a class="apple-mega-card" href="<%= root_path(sort: "price_asc") %>">
            <div class="apple-mega-card__icon"><i class="bi bi-graph-down"></i></div>
            <div>
              <div class="apple-mega-card__headline">Săn giá tốt</div>
              <div class="apple-mega-card__sub">Xem món giá hiện tại thấp.</div>
            </div>
          </a>
          <div class="apple-mega-tip">Tip: Đặt giá 10–30 giây cuối thường "ăn" hơn.</div>
        </div>
      </div>
    </section>

    <%# -- SELL / ĐĂNG BÁN -- %>
    <section id="mega-sell" class="apple-mega-panel" data-mega-panel="sell" hidden>
      <div class="container apple-mega-panel__inner">
        <div class="apple-mega-col">
          <div class="apple-mega-title">Bán hàng</div>
          <a class="apple-mega-link" href="<%= seller_listings_path %>">Đăng bán & quản lý</a>
          <a class="apple-mega-link" href="#">Tạo phiên đấu giá</a>
          <a class="apple-mega-link" href="#">Sản phẩm nháp</a>
          <a class="apple-mega-link" href="#">Lịch sử bán</a>
        </div>

        <div class="apple-mega-col">
          <div class="apple-mega-title">Tối ưu phiên</div>
          <a class="apple-mega-link" href="#">Ảnh rõ – nền sạch</a>
          <a class="apple-mega-link" href="#">Tiêu đề ngắn – đúng ý</a>
          <a class="apple-mega-link" href="#">Giá khởi điểm hợp lý</a>
          <a class="apple-mega-link" href="#">Mô tả minh bạch</a>
        </div>

        <div class="apple-mega-col apple-mega-col--cards">
          <div class="apple-mega-title">Mẫu nhanh</div>
          <a class="apple-mega-card" href="<%= seller_listings_path %>">
            <div class="apple-mega-card__icon"><i class="bi bi-plus-circle"></i></div>
            <div>
              <div class="apple-mega-card__headline">Đăng sản phẩm mới</div>
              <div class="apple-mega-card__sub">5 phút là lên sàn.</div>
            </div>
          </a>
          <a class="apple-mega-card" href="#">
            <div class="apple-mega-card__icon"><i class="bi bi-shield-check"></i></div>
            <div>
              <div class="apple-mega-card__headline">Chính sách & phí</div>
              <div class="apple-mega-card__sub">Minh bạch, không phát sinh.</div>
            </div>
          </a>
          <div class="apple-mega-tip">Tip: Ảnh đầu + tiêu đề quyết định phần lớn lượt click.</div>
        </div>
      </div>
    </section>

    <%# -- MINE / ĐẤU GIÁ CỦA TÔI -- %>
    <section id="mega-mine" class="apple-mega-panel" data-mega-panel="mine" hidden>
      <div class="container apple-mega-panel__inner">
        <div class="apple-mega-col">
          <div class="apple-mega-title">Cá nhân</div>
          <a class="apple-mega-link" href="<%= my_bids_path %>">Đấu giá của tôi</a>
          <a class="apple-mega-link" href="<%= orders_path %>">Đơn hàng</a>
          <a class="apple-mega-link" href="<%= profile_path %>">Tài khoản</a>
          <a class="apple-mega-link" href="#">Sản phẩm đã lưu</a>
        </div>

        <div class="apple-mega-col">
          <div class="apple-mega-title">Theo dõi</div>
          <a class="apple-mega-link" href="#">Lịch sử đặt giá</a>
          <a class="apple-mega-link" href="#">Thông báo</a>
          <a class="apple-mega-link" href="#">Phiên đang xem</a>
          <a class="apple-mega-link" href="#">Gợi ý cho bạn</a>
        </div>

        <div class="apple-mega-col apple-mega-col--cards">
          <div class="apple-mega-title">Mẹo chốt giá</div>
          <div class="apple-mega-card apple-mega-card--static">
            <div class="apple-mega-card__icon"><i class="bi bi-lightning-charge"></i></div>
            <div>
              <div class="apple-mega-card__headline">Chiến thuật "snipe"</div>
              <div class="apple-mega-card__sub">Đặt giá sát giờ kết thúc, tránh đẩy giá sớm.</div>
            </div>
          </div>
          <div class="apple-mega-tip">Tip: Đặt mức tối đa có thể chấp nhận và kỷ luật theo nó.</div>
        </div>
      </div>
    </section>

    <%# -- ABOUT / GIỚI THIỆU (guest) -- %>
    <section id="mega-about" class="apple-mega-panel" data-mega-panel="about" hidden>
      <div class="container apple-mega-panel__inner">
        <div class="apple-mega-col">
          <div class="apple-mega-title">SnapBid là gì?</div>
          <a class="apple-mega-link" href="#">Đấu giá theo thời gian thực</a>
          <a class="apple-mega-link" href="#">Mua ngay (Buy now)</a>
          <a class="apple-mega-link" href="#">Thanh toán & giao nhận</a>
          <a class="apple-mega-link" href="#">Uy tín & an toàn</a>
        </div>
        <div class="apple-mega-col">
          <div class="apple-mega-title">Hướng dẫn nhanh</div>
          <a class="apple-mega-link" href="#">1) Chọn món</a>
          <a class="apple-mega-link" href="#">2) Đặt giá</a>
          <a class="apple-mega-link" href="#">3) Theo dõi phiên</a>
          <a class="apple-mega-link" href="#">4) Chốt & nhận hàng</a>
        </div>
        <div class="apple-mega-col apple-mega-col--cards">
          <div class="apple-mega-title">Điểm nổi bật</div>
          <div class="apple-mega-card apple-mega-card--static">
            <div class="apple-mega-card__icon"><i class="bi bi-stars"></i></div>
            <div>
              <div class="apple-mega-card__headline">UI gọn & nhanh</div>
              <div class="apple-mega-card__sub">Tập trung vào "chốt giá".</div>
            </div>
          </div>
          <div class="apple-mega-tip">Tip: Tạo tài khoản để lưu & theo dõi phiên.</div>
        </div>
      </div>
    </section>

    <%# -- SUPPORT / HỖ TRỢ (guest) -- %>
    <section id="mega-support" class="apple-mega-panel" data-mega-panel="support" hidden>
      <div class="container apple-mega-panel__inner">
        <div class="apple-mega-col">
          <div class="apple-mega-title">Hỗ trợ</div>
          <a class="apple-mega-link" href="<%= help_path %>">Trung tâm Hỗ trợ</a>
          <a class="apple-mega-link" href="<%= help_path %>#faq">Hỏi & Đáp (FAQ)</a>
          <a class="apple-mega-link" href="#">Chính sách</a>
          <a class="apple-mega-link" href="#">Liên hệ</a>
        </div>
        <div class="apple-mega-col">
          <div class="apple-mega-title">Tài khoản</div>
          <a class="apple-mega-link" href="<%= new_user_session_path %>">Đăng nhập</a>
          <a class="apple-mega-link" href="<%= new_user_registration_path %>">Đăng ký</a>
          <a class="apple-mega-link" href="#">Quên mật khẩu</a>
          <a class="apple-mega-link" href="#">Bảo mật</a>
        </div>
        <div class="apple-mega-col apple-mega-col--cards">
          <div class="apple-mega-title">Gợi ý</div>
          <div class="apple-mega-card apple-mega-card--static">
            <div class="apple-mega-card__icon"><i class="bi bi-chat-dots"></i></div>
            <div>
              <div class="apple-mega-card__headline">Phản hồi nhanh</div>
              <div class="apple-mega-card__sub">Mô tả lỗi + ảnh chụp màn hình.</div>
            </div>
          </div>
          <div class="apple-mega-tip">Tip: Mô tả lỗi + ảnh chụp màn hình giúp xử lý nhanh.</div>
        </div>
      </div>
    </section>

  </div><%# /apple-mega-panels %>
</nav>

<%# ===== SEARCH OVERLAY (desktop, bên ngoài nav) ===== %>
<div id="sb-search-overlay" class="sb-nav-search-overlay" role="search" aria-label="Tìm kiếm sản phẩm">
  <div class="sb-nav-search-overlay__inner">
    <%= form_with url: root_path, method: :get, local: true do |f| %>
      <div class="sb-search-form-wrap position-relative">
        <i class="bi bi-search sb-nav-search-input-icon"></i>
        <%= f.text_field :q,
              value: params[:q],
              class: "sb-nav-search-input",
              placeholder: "Tìm kiếm sản phẩm...",
              aria: { label: "Tìm kiếm" },
              autocomplete: "off",
              id: "sb-search-input" %>
        <button type="button" class="sb-nav-search-clear" id="sb-search-clear" aria-label="Xoá">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
    <% end %>
  </div>
</div>

<%# Navbar JS được load qua importmap: pin "navbar" trong config/importmap.rb %>
<%= javascript_import_module_tag "navbar" %>